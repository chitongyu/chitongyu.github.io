{"source":"(window.webpackJsonp=window.webpackJsonp||[]).push([[\"chunk-a3284d20\"],{\"002b\":function(e,t,o){\"use strict\";o.r(t);o(\"7364\"),o(\"591a\");var s={data:function(){return{searchObj:{page:1,pageSize:10},roleId:\"\",loading:!0,roleList:[],permissionList:[],rolePerimissions:\"\",total:null,addDialogFormVisible:!1,updateDialogFormVisible:!1,PermissionDialogFormVisible:!1,addForm:{name:\"\",parentId:0,type:\"1\"},updateForm:{name:\"\",parentId:\"\",id:\"\",type:\"\"},addRuleForm:{name:[{required:!0,message:\"请输入角色名\"}],type:[{required:!0,message:\"请选择类型\"}]},updateRuleForm:{name:[{required:!0,message:\"请输入角色名\"}],type:[{required:!0,message:\"请选择类型\"}]}}},computed:{},watch:{},components:{},methods:{search:function(){this.searchObj.page=1,this.getRoleList()},clearOut:function(){this.searchObj={page:1,pageSize:10}},refresh:function(){this.clearOut(),this.getRoleList()},getRoleList:function(){var t=this;t.loading=!0,t.$http.post(\"/admin/role/list.d\",t.searchObj,function(e){t.roleList=e.body.rows,t.total=e.body.total,t.loading=!1},function(e){t.$message({showClose:!0,message:e.result.msg,type:\"warning\"}),t.loading=!1})},pageNum:function(e){this.searchObj.page=e,this.getRoleList()},pageShowCount:function(e){this.searchObj.pageSize=e,this.getRoleList()},addRole:function(e){this.addForm.parentId=e.id,this.addDialogFormVisible=!0},deleteRole:function(e){var t=this,o=this;this.$confirm(\"确定删除吗？\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){o.loading=!0,o.$http.post(\"/admin/role/delete.d\",{id:e},function(e){o.getRoleList(),o.$message({type:\"success\",message:\"删除成功!\"}),o.loading=!1},function(e){o.$message({showClose:!0,message:e.result.msg,type:\"warning\"}),o.loading=!1})}).catch(function(){t.$message({type:\"info\",message:\"操作异常\"}),o.loading=!1})},updateRole:function(e){this.updateDialogFormVisible=!0,this.updateForm=this.$copyObj(e)},commitAdd:function(){var t=this;this.$refs.addRuleForm.validate(function(e){if(!e)return t.$message({showClose:!0,message:\"输入格式非法\",type:\"warning\"}),!1;t.loading=!0,t.addDialogFormVisible=!1,t.$http.post(\"/admin/role/add.d\",t.addForm,function(e){t.getRoleList(),t.$message({showClose:!0,message:\"新增成功\",type:\"success\"}),t.loading=!1},function(e){t.$message({showClose:!0,message:e.result.msg,type:\"warning\"}),t.loading=!1})})},commitUpdate:function(){var t=this;this.$refs.updateRuleForm.validate(function(e){if(!e)return t.$message({showClose:!0,message:\"输入格式非法\",type:\"warning\"}),!1;t.loading=!0,t.updateDialogFormVisible=!1,t.$filterUpdate(t.updateForm),t.$http.post(\"/admin/role/update.d\",t.updateForm,function(e){t.getRoleList(),t.$message({showClose:!0,message:\"修改成功\",type:\"success\"}),t.loading=!1},function(e){t.$message({showClose:!0,message:e.result.msg,type:\"warning\"}),t.loading=!1})})},updatePermission:function(t){var o=this;o.roleId=t;var s=\"\";o.$http.post(\"/admin/permission/list.d\",{},function(e){o.permissionList=e.body.rows,o.permissionList=o.setData(o.permissionList),o.$http.post(\"/admin/rolePermission/listByRoleId.d\",{roleId:t},function(e){s=e.body.rows,o.PermissionDialogFormVisible=!0,null==s&&(s={});var t=o.getTopNode(s);o.$nextTick(function(){o.$refs.tree.setCheckedNodes(t)})},function(e){o.$message({showClose:!0,message:e.result.msg,type:\"warning\"})})},function(e){o.$message({showClose:!0,message:e.result.msg,type:\"warning\"})})},checkOne:function(t,e){var o=this,s=\"\",a=\"\",i=\"\";i=!(0<=e.checkedKeys.indexOf(t.id)),0<=e.checkedKeys.indexOf(t.id)?(s=\"/admin/rolePermission/add.d\",a=\"添加成功\"):e.checkedKeys.indexOf(t.id)<0?(s=\"/admin/rolePermission/delete.d\",a=\"删除成功\"):(o.$message({showClose:!0,message:\"您没有权限\",type:\"warning\"}),o.$refs.tree.setChecked(t.id,i,!0)),\"\"!=s&&o.$http.post(s,{permissionId:t.id,roleId:o.roleId},function(e){o.$message({showClose:!0,message:a,type:\"success\"})},function(e){o.$nextTick(function(){o.$refs.tree.setChecked(t.id,i,!0)}),o.$message({showClose:!0,message:e.result.msg,type:\"warning\"})})},setData:function(e){var t=[];return function e(t,o){for(var s=o.length,a=0;a<s;a++){var i={id:\"\",label:\"\",children:[]};i.id=o[a].id,i.label=o[a].name,t.push(i),0!=o[a].children.length&&e(t[a].children,o[a].children)}}(t,e),t},getTopNode:function(e){var a=[];return function e(t){for(var o=t.length,s=0;s<o;s++)0==t[s].rolePermissions.length?1==t[s].ifSelect&&a.push({id:t[s].id}):e(t[s].rolePermissions)}(e),a},change:function(e,t,o){var s=this,a=this;this.$confirm(\"确定删除吗？\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){a.$http.post(\"/admin/rolePermission/delete.d\",{permissionId:e.id,roleId:a.roleId},function(e){a.$message({type:\"success\",message:\"删除成功!\"}),a.updatePermission(1)},function(e){a.$message({showClose:!0,message:e.result.msg,type:\"warning\"})})}).catch(function(){s.$message({type:\"info\",message:\"已取消删除\"})})}},mounted:function(){this.getRoleList()}},a=(o(\"4381\"),o(\"6691\")),i=Object(a.a)(s,function(){var o=this,e=o.$createElement,s=o._self._c||e;return s(\"div\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:o.loading,expression:\"loading\"}],staticClass:\"roleManage padding1 w100 h100\"},[o.btPermissions[\"/backend/roleManage\"]?[s(\"el-dialog\",{attrs:{title:\"角色新增\",visible:o.addDialogFormVisible},on:{\"update:visible\":function(e){o.addDialogFormVisible=e}}},[s(\"el-form\",{ref:\"addRuleForm\",attrs:{model:o.addRuleForm,rules:o.addRuleForm,\"status-icon\":\"\",\"label-width\":\"100px\"}},[s(\"el-form-item\",{attrs:{label:\"角色名\",prop:\"name\"}},[s(\"el-input\",{attrs:{name:\"roleName\",\"auto-complete\":\"off\"},model:{value:o.addForm.name,callback:function(e){o.$set(o.addForm,\"name\",\"string\"==typeof e?e.trim():e)},expression:\"addForm.name\"}})],1),s(\"el-form-item\",{attrs:{label:\"角色类型\",prop:\"type\"}},[s(\"el-select\",{attrs:{span:4,filterable:\"\",clearable:\"\",placeholder:\"选择角色类型\"},model:{value:o.addForm.type,callback:function(e){o.$set(o.addForm,\"type\",\"string\"==typeof e?e.trim():e)},expression:\"addForm.type\"}},[s(\"el-option\",{attrs:{label:\"系统管理\",value:\"1\"}},[o._v(\"系统管理\")]),s(\"el-option\",{attrs:{label:\"项目结构\",value:\"2\"}},[o._v(\"项目结构\")])],1)],1)],1),s(\"div\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[s(\"el-button\",{on:{click:function(e){o.addDialogFormVisible=!1}}},[o._v(\"取 消\")]),s(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(e){return o.commitAdd()}}},[o._v(\"确定新增\")])],1)],1),s(\"el-dialog\",{attrs:{title:\"角色修改\",visible:o.updateDialogFormVisible},on:{\"update:visible\":function(e){o.updateDialogFormVisible=e}}},[s(\"el-form\",{ref:\"updateRuleForm\",attrs:{model:o.updateRuleForm,rules:o.updateRuleForm,\"status-icon\":\"\",\"label-width\":\"100px\"}},[s(\"el-form-item\",{attrs:{label:\"新角色名称\",prop:\"name\"}},[s(\"el-input\",{attrs:{name:\"roleName\",\"auto-complete\":\"off\"},model:{value:o.updateForm.name,callback:function(e){o.$set(o.updateForm,\"name\",\"string\"==typeof e?e.trim():e)},expression:\"updateForm.name\"}})],1),s(\"el-form-item\",{attrs:{label:\"角色类型\",prop:\"type\"}},[s(\"el-select\",{attrs:{span:4,filterable:\"\",clearable:\"\",placeholder:\"选择角色类型\"},model:{value:o.updateForm.type,callback:function(e){o.$set(o.updateForm,\"type\",\"string\"==typeof e?e.trim():e)},expression:\"updateForm.type\"}},[s(\"el-option\",{attrs:{label:\"系统管理\",value:\"1\"}},[o._v(\"系统管理\")]),s(\"el-option\",{attrs:{label:\"项目结构\",value:\"2\"}},[o._v(\"项目结构\")])],1)],1)],1),s(\"div\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[s(\"el-button\",{on:{click:function(e){o.updateDialogFormVisible=!1}}},[o._v(\"取 消\")]),s(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(e){return o.commitUpdate()}}},[o._v(\"确定修改\")])],1)],1),s(\"div\",{staticClass:\"role\"},[s(\"el-dialog\",{attrs:{title:\"权限设置\",visible:o.PermissionDialogFormVisible},on:{\"update:visible\":function(e){o.PermissionDialogFormVisible=e}}},[s(\"el-tree\",{ref:\"tree\",attrs:{\"show-checkbox\":\"\",data:o.permissionList,\"node-key\":\"id\",\"default-expand-all\":\"\"},on:{check:o.checkOne}})],1)],1),s(\"div\",{staticClass:\"header ovh\"},[s(\"div\",{staticClass:\"hearder-top\"},[s(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:o.btPermissions[\"/backend/roleManage/add\"],expression:\"btPermissions['/backend/roleManage/add']\"}],style:{\"background-color\":o.bgColor.addBt,\"border-color\":o.bgColor.addBt},attrs:{type:\"danger\",size:\"mini\"},on:{click:function(e){o.addDialogFormVisible=!0,o.addForm.parentId=0}}},[o._v(\"添加\")]),s(\"i\",{staticClass:\"el-icon-refresh refresh fr fs20 poi\",on:{click:function(e){return o.refresh()}}})],1)]),s(\"div\",{staticClass:\"table\"},[s(\"CommonTable\",{attrs:{tableData:o.roleList,refreshFuncName:\"getRoleList\",\"default-sort\":{prop:\"id\",order:\"ascending\"}}},[s(\"template\",{slot:\"main\"},[s(\"el-table-column\",{attrs:{align:\"center\",prop:\"id\",label:\"id\",width:\"100\"}}),s(\"el-table-column\",{attrs:{align:\"center\",prop:\"name\",label:\"角色名\"}}),s(\"el-table-column\",{attrs:{align:\"center\",label:\"操作\"},scopedSlots:o._u([{key:\"default\",fn:function(t){return[s(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:!1,expression:\"false&&btPermissions['/backend/roleManage/add']\"}],style:{\"background-color\":o.bgColor.addBt,\"border-color\":o.bgColor.addBt},attrs:{type:\"danger\",size:\"mini\"},on:{click:function(e){return o.addRole(t.row)}}},[o._v(\"添加子角色\")]),s(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:o.btPermissions[\"/backend/roleManage/update\"],expression:\"btPermissions['/backend/roleManage/update']\"}],style:{\"background-color\":o.bgColor.updateBt,\"border-color\":o.bgColor.updateBt},attrs:{type:\"danger\",size:\"small\"},on:{click:function(e){return o.updateRole(t.row)}}},[o._v(\"修改角色\")]),s(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:o.btPermissions[\"/backend/roleManage/delete\"],expression:\"btPermissions['/backend/roleManage/delete']\"}],style:{\"background-color\":o.bgColor.deleteBt,\"border-color\":o.bgColor.deleteBt},attrs:{type:\"danger\",size:\"small\"},on:{click:function(e){return o.deleteRole(t.row.id)}}},[o._v(\"删除\")]),s(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:o.btPermissions[\"/backend/roleManage/update\"],expression:\"btPermissions['/backend/roleManage/update']\"}],style:{\"background-color\":o.bgColor.redBt,\"border-color\":o.bgColor.redBt},attrs:{type:\"danger\",size:\"small\"},on:{click:function(e){return o.updatePermission(t.row.id)}}},[o._v(\"权限设置\")])]}}])})],1)],2)],1)]:s(\"NoPerimission\")],2)},[],!1,null,\"01dd15b6\",null);t.default=i.exports},4381:function(e,t,o){\"use strict\";var s=o(\"c06e\");o.n(s).a},7364:function(e,t,o){var s=o(\"ddf7\").f,a=Function.prototype,i=/^\\s*function ([^ (]*)/;\"name\"in a||o(\"dad2\")&&s(a,\"name\",{configurable:!0,get:function(){try{return(\"\"+this).match(i)[1]}catch(e){return\"\"}}})},c06e:function(e,t,o){}}]);"}