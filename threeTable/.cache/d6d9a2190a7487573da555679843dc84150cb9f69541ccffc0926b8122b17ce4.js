{"source":"(window.webpackJsonp=window.webpackJsonp||[]).push([[\"chunk-82778a2a\"],{7356:function(t,e,s){},7807:function(t,e,s){\"use strict\";var a=s(\"7356\");s.n(a).a},b0932:function(t,e,s){},d73f:function(t,e,s){\"use strict\";var a=s(\"b0932\");s.n(a).a},e050:function(t,e,s){\"use strict\";s(\"2338\"),s(\"f763\"),s(\"dac5\"),s(\"fb37\");var a=s(\"5bf7\");s(\"7a35\");function i(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}var n={name:\"updateWorkTime\",components:{},filters:{},props:{selectRow:{type:Object,default:function(){},required:!0}},data:function(){return{searchObj:{page:1,pageSize:10},sapCode:this.$store.getters[\"user/getInfo\"]&&this.$store.getters[\"user/getInfo\"].sapCode,updateForms:[],total:0,batchEditFlag:!1,updateFormsCopy:[],oldReportManHours:0,reportManHours:0,oldReportRate:0,reportRate:0,remainManHours:this.selectRow.planManHours-this.selectRow.actualManHours,completeRate:this.selectRow.completionRate,remainManHoursCopy:0,completeRateCopy:0}},computed:{taskId:function(){return this.selectRow.id}},watch:{selectRow:{handler:function(t,e){this.refresh()},deep:!0,immediate:!0}},created:function(){},methods:{ifMyPrinciples:function(t){return t==this.sapCode},refresh:function(){this.getTaskWork()},pageNum:function(t){this.searchObj.page=t,this.getTaskWork()},pageShowCount:function(t){this.searchObj.pageSize=t,this.getTaskWork()},changeManHoursInput:function(t,e){var s=t-e.manHours;e.manHours=t,this.remainManHours=this.remainManHours-s},changeCompleteRateInput:function(t,e){var s=t-e.completionRate;e.completionRate=t,this.completeRate=this.completeRate+s},switchEdit:function(){var t=this.selectRow;3!=t.status?this.ifMyPrinciples(t.principalAdminCode)?(this.batchEditFlag=!this.batchEditFlag,this.batchEditFlag?(this.remainManHoursCopy=this.remainManHours,this.completeRateCopy=this.completeRate):(this.remainManHours=this.remainManHoursCopy,this.completeRate=this.completeRateCopy,this.updateForms=JSON.parse(this.updateFormsCopy))):this.$message({showClose:!0,message:\"该任务不是指派给您的，无法修改\",type:\"warning\"}):this.$message({showClose:!0,message:\"该任务已关闭，无法修改\",type:\"warning\"})},ifCanEdit:function(t,e){return this.$moment(t.createTime).format(\"YYYY-MM-DD\")==this.$moment().format(\"YYYY-MM-DD\")||\"completionRate\"==e},deleteWorkTime:function(t){var e=this;this.$confirm(\"确认删除?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){e.commitDelete(t.id)}).catch(function(){e.$message({type:\"info\",message:\"已取消\"})})},save:function(){var t=this;if(100<this.completeRate)this.$message({showClose:!0,message:\"累计完成率不能大于100%\",type:\"warning\"});else{for(var e=0;e<this.updateForms.length;e++){var s=this.updateForms[e];if(Reflect.deleteProperty(s,\"sapCode\"),Reflect.deleteProperty(s,\"createAdminName\"),Reflect.deleteProperty(s,\"departmentId\"),Reflect.deleteProperty(s,\"groupId\"),Reflect.deleteProperty(s,\"moduleId\"),Reflect.deleteProperty(s,\"projectNumber\"),24<s.manHours||s.manHours<=0)return void this.$message({showClose:!0,message:\"工时范围必须为0~24之间\",type:\"warning\"});if(s.completionRate<=0)return void this.$message({showClose:!0,message:\"完成率必须大于0\",type:\"warning\"});if(this.$isEmpty(s.recordDate)||this.$isEmpty(s.manHours)||this.$isEmpty(s.completionRate)||this.$isEmpty(s.description))return void this.$message({showClose:!0,message:\"请填写完所有项\",type:\"warning\"})}this.$confirm(\"确认提交?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){t.commitUpdate()}).catch(function(){t.$message({type:\"info\",message:\"已取消\"})})}},commitDelete:function(t){var e=this;e.loading=!0,e.$http.post(\"/admin/tfTaskWork/delete.d\",{id:t},function(t){e.$message({type:\"success\",message:\"删除成功!\"}),e.getTaskWork(),e.$emit(\"refresh\")},function(t){e.$message({showClose:!0,message:t.result.msg,type:\"warning\"}),e.loading=!1},function(t){e.$message({showClose:!0,message:t.error+\"-\"+t.message,type:\"warning\"}),e.loading=!1})},commitUpdate:function(){var e=this;e.loading=!0,e.$http.post(\"/admin/tfTaskWork/updates.d\",{tfTaskWorksStr:JSON.stringify(e.updateForms),taskId:e.selectRow.id},function(t){e.$message({showClose:!0,message:\"修改成功\",type:\"success\"}),e.loading=!1,e.getTaskWork(),e.$emit(\"refresh\")},function(t){e.$message({showClose:!0,message:t.result.msg,type:\"warning\"}),e.loading=!1},function(t){e.$message({showClose:!0,message:t.error+\"-\"+t.message,type:\"warning\"}),e.loading=!1})},getTaskWork:function(){var e=this;e.loading=!0,e.$http.post(\"/admin/tfTaskWork/listByPage.d\",function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?i(s,!0).forEach(function(t){Object(a.a)(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i(s).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}({},e.searchObj,{taskId:e.taskId}),function(t){e.updateForms=t.body.rows,e.updateFormsCopy=JSON.stringify(e.updateForms),e.total=t.body.total,e.batchEditFlag=!1,e.oldReportManHours=e.updateForms.reduce(function(t,e){return t+e.manHours},0),e.oldReportRate=e.updateForms.reduce(function(t,e){return t+e.completionRate},0),e.loading=!1},function(t){e.$message({showClose:!0,message:t.result.msg,type:\"warning\"}),e.loading=!1},function(t){e.$message({showClose:!0,message:t.error+\"-\"+t.message,type:\"warning\"}),e.loading=!1})}}},o=(s(\"7807\"),s(\"6691\")),r=Object(o.a)(n,function(){var s=this,t=s.$createElement,a=s._self._c||t;return a(\"div\",{staticClass:\"updateWorkTime w100 padding-left4 padding-right4\"},[a(\"div\",{staticClass:\"updateWorkTime__header w100  margin-top2 flex_row_between\"},[a(\"div\",{staticClass:\"flex_row_start\"},[a(\"div\",[s._v(\"剩余工时:\"),a(\"span\",{staticClass:\"cl_blue\"},[s._v(s._s(s.remainManHours)+\"小时\")])]),a(\"div\",{staticClass:\"margin-left4\"},[s._v(\"工作累计完成率:\"),a(\"span\",{staticClass:\"cl_blue\"},[s._v(s._s(s.completeRate)+\"%\")])]),a(\"div\",{staticClass:\"margin-left4\"},[s._v(\"任务计划开始:\"),a(\"span\",{staticClass:\"cl_blue\"},[s._v(s._s(s.selectRow.planStartTime))])]),a(\"div\",{staticClass:\"margin-left4\"},[s._v(\"任务计划结束:\"),a(\"span\",{staticClass:\"cl_blue\"},[s._v(s._s(s.selectRow.planEndTime))])])]),a(\"div\",[s.batchEditFlag?[a(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(t){return s.save()}}},[s._v(\"保存\")]),a(\"el-button\",{staticClass:\"fs_13\",on:{click:s.switchEdit}},[s._v(\"取消\")])]:a(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:0<s.updateForms.length,expression:\"updateForms.length>0\"}],staticClass:\"fs_13\",attrs:{type:\"primary\"},on:{click:s.switchEdit}},[s._v(\"批量修改\")])],2)]),a(\"div\",{staticClass:\"updateWorkTime__body margin-top2\"},[a(\"table\",{staticClass:\"w100  tableForm\"},[a(\"tbody\",[s._m(0),s._l(s.updateForms,function(e,t){return a(\"tr\",{key:t},[a(\"td\",{attrs:{width:\"100\"}},[s._v(s._s(t+1))]),a(\"td\",{attrs:{width:\"150\"}},[s.batchEditFlag&&s.ifCanEdit(e,\"recordDate\")?a(\"el-date-picker\",{staticClass:\"mini-date\",attrs:{type:\"date\",\"value-format\":\"yyyy-MM-dd\",placeholder:\"日期\"},model:{value:e.recordDate,callback:function(t){s.$set(e,\"recordDate\",t)},expression:\"item.recordDate\"}}):a(\"span\",[s._v(\"\\n                \"+s._s(e.recordDate)+\"\\n              \")])],1),a(\"td\",{attrs:{width:\"100\"}},[s.batchEditFlag&&s.ifCanEdit(e,\"manHours\")?a(\"el-input\",{staticClass:\"mini-input\",staticStyle:{width:\"80px\"},attrs:{placeholder:\"\",type:\"Number\",maxlength:3,value:e.manHours,clearable:\"\"},on:{input:function(t){s.changeManHoursInput(t,e)}}}):a(\"span\",[s._v(\"\\n                \"+s._s(e.manHours)+\"\\n              \")])],1),a(\"td\",{attrs:{width:\"100\"}},[s.batchEditFlag&&s.ifCanEdit(e,\"completionRate\")?a(\"el-input\",{staticClass:\"mini-input\",staticStyle:{width:\"80px\"},attrs:{placeholder:\"\",type:\"Number\",value:e.completionRate,maxlength:3,clearable:\"\"},on:{input:function(t){s.changeCompleteRateInput(t,e)}}}):a(\"span\",[s._v(\"\\n                \"+s._s(e.completionRate)+\"\\n              \")])],1),a(\"td\",{attrs:{width:\"500\"}},[s.batchEditFlag&&s.ifCanEdit(e,\"description\")?a(\"el-input\",{staticClass:\"mini-input\",staticStyle:{width:\"500px\"},attrs:{placeholder:\"\",type:\"text\",maxlength:100,\"show-word-limit\":\"\",clearable:\"\"},model:{value:e.description,callback:function(t){s.$set(e,\"description\",t)},expression:\"item.description\"}}):a(\"span\",[s._v(\"\\n                \"+s._s(e.description)+\"\\n              \")])],1),a(\"td\",{attrs:{width:\"100\"}},[a(\"div\",[s._e(),a(\"i\",{staticClass:\"iconfont icon-cha fs_20 cl_red\",on:{click:function(t){return s.deleteWorkTime(e)}}})])])])})],2)])]),a(\"div\",{staticClass:\"updateWorkTime__footer w100  margin-top4 flex_column_start \"},[s.batchEditFlag?s._e():a(\"Pagination\",{ref:\"pagination\",attrs:{pageSizeNum:10,totalNum:s.total},on:{\"child-say\":s.pageNum,\"child-say2\":s.pageShowCount}}),s._e()],1)])},[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s(\"tr\",{staticClass:\"header\"},[s(\"td\",{attrs:{width:\"100\"}},[t._v(\"序号\")]),s(\"td\",{attrs:{width:\"150\"}},[t._v(\"日期\")]),s(\"td\",{attrs:{width:\"100\"}},[t._v(\"投入工时\")]),s(\"td\",{attrs:{width:\"100\"}},[t._v(\"今日完成率\")]),s(\"td\",{attrs:{width:\"400\"}},[t._v(\"报工描述\")]),s(\"td\",{attrs:{width:\"100\"}})])}],!1,null,null,null);e.a=r.exports},f1dd:function(t,e,s){\"use strict\";s(\"d4d5\"),s(\"f763\");var a={name:\"addWorkTime\",components:{},filters:{},props:{selectRow:{type:Object,default:function(){},required:!0}},data:function(){return{addForms:[{recordDate:\"\",manHours:\"\",completionRate:\"\",description:\"\"}],reportManHours:0,reportRate:0}},computed:{remainManHours:function(){return this.selectRow.planManHours-this.selectRow.actualManHours-this.reportManHours},completeRate:function(){return this.selectRow.completionRate+this.reportRate}},watch:{addForms:{handler:function(t,e){var s=this;this.reportRate=0,t.forEach(function(t){s.$isEmpty(t.completionRate)||(s.reportRate=s.reportRate+Number(t.completionRate))}),this.reportManHours=0,t.forEach(function(t){s.$isEmpty(t.manHours)||(s.reportManHours=s.reportManHours+Number(t.manHours))})},deep:!0,immediate:!0}},created:function(){},methods:{handlerDate:function(t,e){var s=this.$moment(this.$moment().format(\"YYYY-MM-DD\"));this.$moment(this.$moment(t).format(\"YYYY-MM-DD\"));s.isBefore(t)&&(e.recordDate=\"\",this.$message({showClose:!0,message:\"报工日期不能超过今天\",type:\"warning\"}))},addNode:function(t){this.addForms.splice(t+1,0,{recordDate:\"\",manHours:\"\",completionRate:\"\",description:\"\"})},deleteNode:function(t){1<this.addForms.length?this.addForms.splice(t,1):this.$message({showClose:!0,message:\"不能再删除了\",type:\"warning\"})},save:function(){for(var t=this,e=!0,s=0;s<this.addForms.length;s++){var a=this.addForms[s];for(var i in a){if(24<a.manHours||a.manHours<=0)return void this.$message({showClose:!0,message:\"工时范围必须为0~24之间\",type:\"warning\"});if(a.completionRate<=0)return void this.$message({showClose:!0,message:\"完成率必须大于0\",type:\"warning\"});if(this.$isEmpty(a[i])){e=!1;break}}}e?100<this.completeRate?this.$message({showClose:!0,message:\"累计完成率不能大于100%\",type:\"warning\"}):this.$confirm(\"确认提交?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){t.commitAdd()}).catch(function(){t.$message({type:\"info\",message:\"已取消\"})}):this.$message({showClose:!0,message:\"请填写完所有项\",type:\"warning\"})},commitAdd:function(){var e=this;e.loading=!0,e.addDialogFormVisible=!1,e.$http.post(\"/admin/tfTaskWork/adds.d\",{tfTaskWorksStr:JSON.stringify(e.addForms),taskId:e.selectRow.id},function(t){e.$message({showClose:!0,message:\"新增成功\",type:\"success\"}),e.addForms=[{recordDate:\"\",manHours:\"\",completionRate:\"\",description:\"\"}],e.loading=!1,e.$emit(\"cancel\")},function(t){e.$message({showClose:!0,message:t.result.msg,type:\"warning\"}),e.loading=!1},function(t){e.$message({showClose:!0,message:t.error+\"-\"+t.message,type:\"warning\"}),e.loading=!1})}}},i=(s(\"d73f\"),s(\"6691\")),n=Object(i.a)(a,function(){var a=this,t=a.$createElement,i=a._self._c||t;return i(\"div\",{staticClass:\"addWorkTime w100 padding-left4 padding-right4\"},[i(\"div\",{staticClass:\"addWorkTime__header w100  margin-top2 flex_row_between\"},[i(\"div\",{staticClass:\"flex_row_start\"},[i(\"div\",[a._v(\"剩余工时:\"),i(\"span\",{staticClass:\"cl_blue\"},[a._v(a._s(a.remainManHours)+\"小时\")])]),i(\"div\",{staticClass:\"margin-left4\"},[a._v(\"工作累计完成率:\"),i(\"span\",{staticClass:\"cl_blue\"},[a._v(a._s(a.completeRate)+\"%\")])]),i(\"div\",{staticClass:\"margin-left4\"},[a._v(\"任务计划开始:\"),i(\"span\",{staticClass:\"cl_blue\"},[a._v(a._s(a.selectRow.planStartTime))])]),i(\"div\",{staticClass:\"margin-left4\"},[a._v(\"任务计划结束:\"),i(\"span\",{staticClass:\"cl_blue\"},[a._v(a._s(a.selectRow.planEndTime))])])])]),i(\"div\",{staticClass:\"addWorkTime__body margin-top2\"},[i(\"table\",{staticClass:\"w100  tableForm\"},[i(\"tbody\",[a._m(0),a._l(a.addForms,function(e,s){return i(\"tr\",{key:s},[i(\"td\",{attrs:{width:\"100\"}},[a._v(a._s(s+1))]),i(\"td\",{attrs:{width:\"150\"}},[i(\"el-date-picker\",{staticClass:\"mini-date\",attrs:{type:\"date\",\"value-format\":\"yyyy-MM-dd\",placeholder:\"日期\"},on:{change:function(t){a.handlerDate(t,e)}},model:{value:e.recordDate,callback:function(t){a.$set(e,\"recordDate\",t)},expression:\"item.recordDate\"}})],1),i(\"td\",{attrs:{width:\"80\"}},[i(\"el-input\",{staticClass:\"mini-input\",staticStyle:{width:\"80px\"},attrs:{placeholder:\"\",type:\"Number\",maxlength:3,clearable:\"\"},model:{value:e.manHours,callback:function(t){a.$set(e,\"manHours\",t)},expression:\"item.manHours\"}})],1),i(\"td\",{attrs:{width:\"80\"}},[i(\"el-input\",{staticClass:\"mini-input\",staticStyle:{width:\"80px\"},attrs:{placeholder:\"\",type:\"Number\",maxlength:3,clearable:\"\"},model:{value:e.completionRate,callback:function(t){a.$set(e,\"completionRate\",t)},expression:\"item.completionRate\"}})],1),i(\"td\",{attrs:{width:\"500\"}},[i(\"el-input\",{staticClass:\"mini-input\",staticStyle:{width:\"500px\"},attrs:{placeholder:\"\",type:\"text\",maxlength:100,\"show-word-limit\":\"\",clearable:\"\"},model:{value:e.description,callback:function(t){a.$set(e,\"description\",t)},expression:\"item.description\"}})],1),i(\"td\",{attrs:{width:\"100\"}},[i(\"div\",[i(\"i\",{staticClass:\"iconfont icon-jia fs_20 cl_blue\",on:{click:function(t){return a.addNode(s)}}}),i(\"i\",{staticClass:\"iconfont icon-cha fs_20 cl_red\",on:{click:function(t){return a.deleteNode(s)}}})])])])})],2)])]),i(\"div\",{staticClass:\"addWorkTime__footer w100  margin-top2 flex_row_center\"},[i(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(t){return a.save()}}},[a._v(\"保存\")]),i(\"el-button\",{on:{click:function(t){return a.$emit(\"back\")}}},[a._v(\"返回\")])],1)])},[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s(\"tr\",{staticClass:\"header\"},[s(\"td\",{attrs:{width:\"100\"}},[t._v(\"序号\")]),s(\"td\",{attrs:{width:\"150\"}},[t._v(\"日期\")]),s(\"td\",{attrs:{width:\"80\"}},[t._v(\"投入工时\")]),s(\"td\",{attrs:{width:\"80\"}},[t._v(\"今日完成率\")]),s(\"td\",{attrs:{width:\"400\"}},[t._v(\"报工描述\")]),s(\"td\",{attrs:{width:\"100\"}})])}],!1,null,null,null);e.a=n.exports}}]);"}